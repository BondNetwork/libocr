import { ethers } from 'hardhat'
import {BigNumber, Contract, ContractFactory, Signer} from 'ethers'
import {AccessControlledOffchainAggregator, AccessControlledOffchainAggregator__factory} from "../typechain";

let defaultAccount: Signer

let accessControlledOffchainAggregatorFactory: ContractFactory
let offchainAggregatorFactory: ContractFactory


before(async () => {
    const accounts = await ethers.getSigners();
    accessControlledOffchainAggregatorFactory = await ethers.getContractFactory(
        'contract/AccessControlledOffchainAggregator.sol:AccessControlledOffchainAggregator',
        accounts[0],
    )
    offchainAggregatorFactory = await ethers.getContractFactory(
        'contract/OffchainAggregator.sol:OffchainAggregator',
        accounts[0],
    )
})

describe('aggreator_test', () => {
    it('setconfig_local ', async () => {
        let provider = ethers.getDefaultProvider("https://twilight-magical-snowflake.ethereum-sepolia.discover.quiknode.pro/d88ffbe6a53853e28f56142c912a288eb298dada/");
        let privateKey = 'b588f6bf79507310840ba922e1a28c8cd16a5db34ac8161a8c5932692d0addfc';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0xF28e2d06D688Dc1DF0ACA3A2F37d09D3b9b3df56', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        console.log('addr:', contractWithSigner.address);
        const setPayees_tx = await contractWithSigner.setPayees(['0x76bbEe950B88306f87782c546B411E0Ab0528Ba2','0xEeb4587dC5DB5681b70DD6C0Ff8f62EdABDf1a63','0x368c543709e84A566fF70fB6E01dfd0701f75C22','0x12b1c0E39a4BeF9dC97Cbc06d90E3a61E6fb64b1'],
        ['0x76bbEe950B88306f87782c546B411E0Ab0528Ba2','0xEeb4587dC5DB5681b70DD6C0Ff8f62EdABDf1a63','0x368c543709e84A566fF70fB6E01dfd0701f75C22','0x12b1c0E39a4BeF9dC97Cbc06d90E3a61E6fb64b1']);
        console.log('setPayees_tx:', setPayees_tx);

        const setConfig_tx = await  contractWithSigner.setConfig(['0x3a9045f6314b6eb7b2cDFFb3Aa68d9f95752930b','0xbB5426beD1Ae3446D8d5D8C2d2da04EF2Db9aeeE','0x85d25b04D3A29B64A6d33759b0f37028550dA617','0xA428DEE370F1f42031BDA9cC9dfc32056C27bFeE'],
        ['0x76bbEe950B88306f87782c546B411E0Ab0528Ba2','0xEeb4587dC5DB5681b70DD6C0Ff8f62EdABDf1a63','0x368c543709e84A566fF70fB6E01dfd0701f75C22','0x12b1c0E39a4BeF9dC97Cbc06d90E3a61E6fb64b1'],
            1, 1,
            '0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000001a3185c5000000000000000000000000000000000000000000000000000000000037e11d600000000000000000000000000000000000000000000000000000000d18c2e28000000000000000000000000000000000000000000000000000000000077359400000000000000000000000000000000000000000000000000000001a3185c5000000000000000000000000000000000000000000000000000000000000098968000000000000000000000000000000000000000000000000000000006fc23ac0000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000432a36778e6c1663cf339bd42a7918638c9afd220f1160f44671a47c73971d672bfab30f35d5f9866588e52a07a882a867a200abf5e1d81eb1c0cef119a5d86932f70b609eb2633fd00ef45ae129d5a26d7d417d362afae6af35df2367ed8664812ec5db1dacc74ffe509f7a5743b81294403ff296add9a0a73933154a791bdc800000000000000000000000000000000000000000000000000000000000000d3313244334b6f6f57533471737238644535727a727a6e5a6359436a4d684a5a48393442544e35626e72506d34577551334c7537662c313244334b6f6f574d766b37317a5068687735626461695a7638774c414356666233343333696b37585868454b6f77364b4847522c313244334b6f6f57426a715354467045526976766f4e527134364d674148423272476976486537515648736f7a764e45355255452c313244334b6f6f574e3461486f726e6639594a6b7852756a396a454752676a567069467472454c5647753468707663636764795a000000000000000000000000006c63d0cd90d5ff34335b470fe4e143531cc0d1c3a4fbc544b842c7cf087f1c6b1a1bf753c2505dab5204b284f1fefd7dc4eb83f6304664c9c2f43cbf425666600000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000460feba1aa9c1320dbd7b7ee547341a0b00000000000000000000000000000000fcd5690864e18ec49426018ed34a0d950000000000000000000000000000000006dccc31cca4e0b838091ecd991aec2400000000000000000000000000000000b3192e8fce48f1febdc70e55cd7c34b600000000000000000000000000000000',
            {gasPrice:1000000000, gasLimit:2100000});
        console.log('setconfig_tx', setConfig_tx);
    })
    it('setconfig_test ', async () => {
        let provider = ethers.getDefaultProvider("https://twilight-magical-snowflake.ethereum-sepolia.discover.quiknode.pro/d88ffbe6a53853e28f56142c912a288eb298dada/");
        let privateKey = 'b588f6bf79507310840ba922e1a28c8cd16a5db34ac8161a8c5932692d0addfc';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0xF28e2d06D688Dc1DF0ACA3A2F37d09D3b9b3df56', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        console.log('addr:', contractWithSigner.address);
        const setPayees_tx = await contractWithSigner.setPayees(['0x9FA5556B8B260B09773EDe96086daC38Aa5A4BCb','0xD2c10a30732CF7eC3EB69A733F09BC67d4E46aB5','0x9f10466dFA8a5a34b199c15Af3BA26488E319328','0x5bE9Dd2BE5143f751779E60dAF8c64a27E31f43c'],
        ['0x9FA5556B8B260B09773EDe96086daC38Aa5A4BCb','0xD2c10a30732CF7eC3EB69A733F09BC67d4E46aB5','0x9f10466dFA8a5a34b199c15Af3BA26488E319328','0x5bE9Dd2BE5143f751779E60dAF8c64a27E31f43c']);
        console.log('setPayees_tx:', setPayees_tx);

        const setConfig_tx = await  contractWithSigner.setConfig(['0x37aF2e3356D9c86124A1EA2D58637A650aB3B762','0xe5209F6D1C2Fa537428e0d3EbF91BAFB7502dE45','0x7e1A1eFa0C663E930EF717c9Db9dd0B08a459052','0x62545E0AD661120d554CE56D77db6854561aE9B3'],
        ['0x9FA5556B8B260B09773EDe96086daC38Aa5A4BCb','0xD2c10a30732CF7eC3EB69A733F09BC67d4E46aB5','0x9f10466dFA8a5a34b199c15Af3BA26488E319328','0x5bE9Dd2BE5143f751779E60dAF8c64a27E31f43c'],
            1, 1,
            '0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000068c61714000000000000000000000000000000000000000000000000000000000037e11d600000000000000000000000000000000000000000000000000000001a3185c500000000000000000000000000000000000000000000000000000000000773594000000000000000000000000000000000000000000000000000000034630b8a000000000000000000000000000000000000000000000000000000000000098968000000000000000000000000000000000000000000000000000000006fc23ac0000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000043674d6e4abbaa1cb773f29d999563268fb3417b99b140b4cdafe9c9d54cbc31b00e7f28b5454feb2c1df7a87fd241b9e84e8c515c04b34409d6bf95e2198b1d05ecea5803bced092163aadb26603699e82aa33d409213c75a66851517d9f4f7ede9d6d8cf8fe9a6f66ee29e69f86c2ec16aca83700a902d1188a824c5ffa851700000000000000000000000000000000000000000000000000000000000000d3313244334b6f6f5753417353614c6e694858706e5644644e5a4e71394e694b654670743962456d5054456631325754345152334a2c313244334b6f6f57507447486977717933476b4c503954366a4e455a6e79766464446752364c6f44364b6e4c68785a314a48536f2c313244334b6f6f574b743650674146434e624c4c564834443139546e45694564486239456771516f59693965694662686e6463422c313244334b6f6f5751524637424446575a6f7346656e757354365557466464334e6b56645066784c67766b4745675652597777700000000000000000000000000080f07990c6a766929c6b2ced493237d36a30f2c3d34c25777b2fe06f7d3915221a1bf753c2505dab5204b284f1fefd7dc4eb83f6304664c9c2f43cbf42566660000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000045f1f86097bdf9cb4304553e39544b3ca00000000000000000000000000000000bf0dc68a3c635b24bee8525f9c7c6e0e00000000000000000000000000000000abf86f77bc1932a9ef0e67f84994cfe60000000000000000000000000000000049c9df3c70774657e0da24a2e49df08900000000000000000000000000000000',
            {gasPrice:1000000000, gasLimit:2100000});
        console.log('setconfig_test_tx', setConfig_tx);
        console.log('t:', await contractWithSigner.transmitters());
    })
    it('getanswer ', async () => {
        let provider = ethers.getDefaultProvider("https://twilight-magical-snowflake.ethereum-sepolia.discover.quiknode.pro/d88ffbe6a53853e28f56142c912a288eb298dada/");
        let privateKey = 'b588f6bf79507310840ba922e1a28c8cd16a5db34ac8161a8c5932692d0addfc';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0xF28e2d06D688Dc1DF0ACA3A2F37d09D3b9b3df56', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        const getAnswer_tx = await  contractWithSigner.latestMerkleRoundData();
        console.log('getAnswer_tx', getAnswer_tx);
    })
    it('getTransmitters ', async () => {
        const [ownerSigner] = await ethers.getSigners();
        const offchainAggregatorC =  AccessControlledOffchainAggregator__factory.connect('0xF28e2d06D688Dc1DF0ACA3A2F37d09D3b9b3df56', ownerSigner);
        console.log('addr:', offchainAggregatorC.address);
        console.log('t:', await offchainAggregatorC.transmitters());
    })
})
