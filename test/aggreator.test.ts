import { ethers } from 'hardhat'
import {BigNumber, Contract, ContractFactory, Signer} from 'ethers'
import {AccessControlledOffchainAggregator, AccessControlledOffchainAggregator__factory} from "../typechain";

let defaultAccount: Signer

let accessControlledOffchainAggregatorFactory: ContractFactory
let offchainAggregatorFactory: ContractFactory


before(async () => {
    const accounts = await ethers.getSigners();
    accessControlledOffchainAggregatorFactory = await ethers.getContractFactory(
        'contract/AccessControlledOffchainAggregator.sol:AccessControlledOffchainAggregator',
        accounts[0],
    )
    offchainAggregatorFactory = await ethers.getContractFactory(
        'contract/OffchainAggregator.sol:OffchainAggregator',
        accounts[0],
    )
})

describe('aggreator_test', () => {
    it('setconfig ', async () => {
        let provider = ethers.getDefaultProvider("https://twilight-magical-snowflake.ethereum-sepolia.discover.quiknode.pro/d88ffbe6a53853e28f56142c912a288eb298dada/");
        let privateKey = 'b588f6bf79507310840ba922e1a28c8cd16a5db34ac8161a8c5932692d0addfc';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0xF28e2d06D688Dc1DF0ACA3A2F37d09D3b9b3df56', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        console.log('addr:', contractWithSigner.address);
        const setPayees_tx = await contractWithSigner.setPayees(['0x76bbEe950B88306f87782c546B411E0Ab0528Ba2','0xEeb4587dC5DB5681b70DD6C0Ff8f62EdABDf1a63','0x368c543709e84A566fF70fB6E01dfd0701f75C22','0x12b1c0E39a4BeF9dC97Cbc06d90E3a61E6fb64b1'],
        ['0x76bbEe950B88306f87782c546B411E0Ab0528Ba2','0xEeb4587dC5DB5681b70DD6C0Ff8f62EdABDf1a63','0x368c543709e84A566fF70fB6E01dfd0701f75C22','0x12b1c0E39a4BeF9dC97Cbc06d90E3a61E6fb64b1']);
        console.log('setPayees_tx:', setPayees_tx);

        const setConfig_tx = await  contractWithSigner.setConfig(['0x3a9045f6314b6eb7b2cDFFb3Aa68d9f95752930b','0xbB5426beD1Ae3446D8d5D8C2d2da04EF2Db9aeeE','0x85d25b04D3A29B64A6d33759b0f37028550dA617','0xA428DEE370F1f42031BDA9cC9dfc32056C27bFeE'],
        ['0x76bbEe950B88306f87782c546B411E0Ab0528Ba2','0xEeb4587dC5DB5681b70DD6C0Ff8f62EdABDf1a63','0x368c543709e84A566fF70fB6E01dfd0701f75C22','0x12b1c0E39a4BeF9dC97Cbc06d90E3a61E6fb64b1'],
            1, 1,
            '0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000077359400000000000000000000000000000000000000000000000000000000003b9aca00000000000000000000000000000000000000000000000000000000003b9aca00000000000000000000000000000000000000000000000000000000001dcd650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000989680000000000000000000000000000000000000000000000000000000007735940000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000432a36778e6c1663cf339bd42a7918638c9afd220f1160f44671a47c73971d672bfab30f35d5f9866588e52a07a882a867a200abf5e1d81eb1c0cef119a5d86932f70b609eb2633fd00ef45ae129d5a26d7d417d362afae6af35df2367ed8664812ec5db1dacc74ffe509f7a5743b81294403ff296add9a0a73933154a791bdc800000000000000000000000000000000000000000000000000000000000000d3313244334b6f6f57533471737238644535727a727a6e5a6359436a4d684a5a48393442544e35626e72506d34577551334c7537662c313244334b6f6f574d766b37317a5068687735626461695a7638774c414356666233343333696b37585868454b6f77364b4847522c313244334b6f6f57426a715354467045526976766f4e527134364d674148423272476976486537515648736f7a764e45355255452c313244334b6f6f574e3461486f726e6639594a6b7852756a396a454752676a567069467472454c5647753468707663636764795a00000000000000000000000000f416798d3bc92c2954b841c14aa8d307713d1f72faa524247d622ccfe7cc5a001a1bf753c2505dab5204b284f1fefd7dc4eb83f6304664c9c2f43cbf425666600000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000459f71db8b76eaa1ddd6e53da445cc8b70000000000000000000000000000000033d86f5459a75d59d8d94a35cc41952c000000000000000000000000000000000ff2f1db05d18fa313aa170f51fd4ca300000000000000000000000000000000ab3e675017b39a99757702298b746de700000000000000000000000000000000',
            {gasPrice:800000, gasLimit:2100000});
        console.log('setconfig_tx', setConfig_tx);
    })
    it('getanswer ', async () => {
        let provider = ethers.getDefaultProvider("https://twilight-magical-snowflake.ethereum-sepolia.discover.quiknode.pro/d88ffbe6a53853e28f56142c912a288eb298dada/");
        let privateKey = 'b588f6bf79507310840ba922e1a28c8cd16a5db34ac8161a8c5932692d0addfc';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0xF28e2d06D688Dc1DF0ACA3A2F37d09D3b9b3df56', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        const getAnswer_tx = await  contractWithSigner.latestMerkleRoundData();
        console.log('getAnswer_tx', getAnswer_tx);

        //const transmitters_tx = await contractWithSigner.transmitters()
        //console.log('transmitters_tx', transmitters_tx)
    })
})
