import { ethers } from 'hardhat'
import {BigNumber, Contract, ContractFactory, Signer} from 'ethers'
import {AccessControlledOffchainAggregator, AccessControlledOffchainAggregator__factory} from "../typechain";

let defaultAccount: Signer

let accessControlledOffchainAggregatorFactory: ContractFactory
let offchainAggregatorFactory: ContractFactory


before(async () => {
    const accounts = await ethers.getSigners();
    accessControlledOffchainAggregatorFactory = await ethers.getContractFactory(
        'contract/AccessControlledOffchainAggregator.sol:AccessControlledOffchainAggregator',
        accounts[0],
    )
    offchainAggregatorFactory = await ethers.getContractFactory(
        'contract/OffchainAggregator.sol:OffchainAggregator',
        accounts[0],
    )
})

describe('aggreator_test', () => {
    it('setconfig ', async () => {
        let provider = ethers.getDefaultProvider("ws://127.0.0.1:8545");
        let privateKey = '0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0x99bbA657f2BbC93c02D617f8bA121cB8Fc104Acf', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        console.log('addr:', contractWithSigner.address);
        const setPayees_tx = await contractWithSigner.setPayees(['0x2897230A8383bCA59Bf2Dcd68Be4F446FdcbE92B','0xD282F11FA25142317580078FD53523817Aa1c3Dd','0x240345493d2875FF1E3Be1754D9d27ef8Fa63f82','0xc95930Df0673238241a6CB74bc5Ee05f30f00524'],
        ['0x2897230A8383bCA59Bf2Dcd68Be4F446FdcbE92B','0xD282F11FA25142317580078FD53523817Aa1c3Dd','0x240345493d2875FF1E3Be1754D9d27ef8Fa63f82','0xc95930Df0673238241a6CB74bc5Ee05f30f00524']);
        console.log('setPayees_tx:', setPayees_tx);

        const setConfig_tx = await  contractWithSigner.setConfig(['0x3a9045f6314b6eb7b2cDFFb3Aa68d9f95752930b','0xbB5426beD1Ae3446D8d5D8C2d2da04EF2Db9aeeE','0x85d25b04D3A29B64A6d33759b0f37028550dA617','0xA428DEE370F1f42031BDA9cC9dfc32056C27bFeE'],
        ['0x2897230A8383bCA59Bf2Dcd68Be4F446FdcbE92B','0xD282F11FA25142317580078FD53523817Aa1c3Dd','0x240345493d2875FF1E3Be1754D9d27ef8Fa63f82','0xc95930Df0673238241a6CB74bc5Ee05f30f00524'],
            1, 1,
            '0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000077359400000000000000000000000000000000000000000000000000000000003b9aca00000000000000000000000000000000000000000000000000000000003b9aca00000000000000000000000000000000000000000000000000000000001dcd650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000989680000000000000000000000000000000000000000000000000000000007735940000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000432a36778e6c1663cf339bd42a7918638c9afd220f1160f44671a47c73971d672bfab30f35d5f9866588e52a07a882a867a200abf5e1d81eb1c0cef119a5d86932f70b609eb2633fd00ef45ae129d5a26d7d417d362afae6af35df2367ed8664812ec5db1dacc74ffe509f7a5743b81294403ff296add9a0a73933154a791bdc800000000000000000000000000000000000000000000000000000000000000d3313244334b6f6f57533471737238644535727a727a6e5a6359436a4d684a5a48393442544e35626e72506d34577551334c7537662c313244334b6f6f574d766b37317a5068687735626461695a7638774c414356666233343333696b37585868454b6f77364b4847522c313244334b6f6f57426a715354467045526976766f4e527134364d674148423272476976486537515648736f7a764e45355255452c313244334b6f6f574e3461486f726e6639594a6b7852756a396a454752676a567069467472454c5647753468707663636764795a000000000000000000000000008e413031f1f708cee39ceaa26ed05c1bfd6fd932d3dfc90108c3fd53540743391a1bf753c2505dab5204b284f1fefd7dc4eb83f6304664c9c2f43cbf4256666000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000004479bd3b8584503788b8892b711ae3122000000000000000000000000000000008e9e295ae4663217f40644504d790ff8000000000000000000000000000000009821137d93be5ea286df0461e091aef600000000000000000000000000000000783d6f701e1b38877b5e1607e71ffc6f00000000000000000000000000000000',
            {gasPrice:800000000000, gasLimit:2100000});
        console.log('setconfig_tx', setConfig_tx);
    })
    it('getanswer ', async () => {
        let provider = ethers.getDefaultProvider("ws://127.0.0.1:8545");
        let privateKey = '0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0x99bbA657f2BbC93c02D617f8bA121cB8Fc104Acf', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        const getAnswer_tx = await  contractWithSigner.latestMerkleRoundData();
        console.log('getAnswer_tx', getAnswer_tx);

        //const transmitters_tx = await contractWithSigner.transmitters()
        //console.log('transmitters_tx', transmitters_tx)
    })
})
