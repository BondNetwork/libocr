import { ethers } from 'hardhat'
import {BigNumber, Contract, ContractFactory, Signer} from 'ethers'
import {AccessControlledOffchainAggregator, AccessControlledOffchainAggregator__factory} from "../typechain";

let defaultAccount: Signer

let accessControlledOffchainAggregatorFactory: ContractFactory
let offchainAggregatorFactory: ContractFactory


before(async () => {
    const accounts = await ethers.getSigners();
    accessControlledOffchainAggregatorFactory = await ethers.getContractFactory(
        'contract/AccessControlledOffchainAggregator.sol:AccessControlledOffchainAggregator',
        accounts[0],
    )
    offchainAggregatorFactory = await ethers.getContractFactory(
        'contract/OffchainAggregator.sol:OffchainAggregator',
        accounts[0],
    )
})

describe('aggreator_test', () => {
    it('setconfig_local ', async () => {
        let provider = ethers.getDefaultProvider("https://twilight-magical-snowflake.ethereum-sepolia.discover.quiknode.pro/d88ffbe6a53853e28f56142c912a288eb298dada/");
        let privateKey = 'b588f6bf79507310840ba922e1a28c8cd16a5db34ac8161a8c5932692d0addfc';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0x7fac6B3BFCfbDE3a77D79ae41F7C0838809515eF', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        console.log('addr:', contractWithSigner.address);
        /*const setPayees_tx = await contractWithSigner.setPayees(['0x579d108dDa1E72df776323f022A93B2F99A4c884','0x7b8fbf39314429D91759e7c26ad72E405aA280cF','0xaDaA683c1F38762A15763AE0a40d1a85311d53Aa','0x034F6F357f31e61841Ddb12BA0e3f808F19B32aF'],
            ['0x630b49cF106f61824e5fA2Da7313fD776928921d','0xdA1Da56A712C77c4dF0B7a61B0E75F4026c8c09a','0xF4888aEd11bFA9ADcfa25B42E11Cb6E064A354b8','0x1205FC050610ea92D4A938121f011ce86271C7ce'],{gasPrice:10000000000, gasLimit:2100000});
        console.log('setPayees_tx:', setPayees_tx);
        setPayees_tx.wait(3)*/

        const setConfig_tx = await  contractWithSigner.setConfig(['0x4fbc25216097273300aDbf0c90c42e2bA55A5260','0x4cBf3f8f99b36c150304F2c54D1eeC234175e208','0xd7F3cb890261173a0Be8f88381e470216CA17162','0xD8A8ec3a2D174ea84cbcb30fE55bB349fc7F74c9'],
        ['0x579d108dDa1E72df776323f022A93B2F99A4c884','0x7b8fbf39314429D91759e7c26ad72E405aA280cF','0xaDaA683c1F38762A15763AE0a40d1a85311d53Aa','0x034F6F357f31e61841Ddb12BA0e3f808F19B32aF'],
            1, 1,
            '0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000029e8d60800000000000000000000000000000000000000000000000000000000037e11d6000000000000000000000000000000000000000000000000000000000df847580000000000000000000000000000000000000000000000000000000000773594000000000000000000000000000000000000000000000000000000000df8475800000000000000000000000000000000000000000000000000000000000098968000000000000000000000000000000000000000000000000000000002540be40000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000453ef3c4ed0e1984520e63c447e7a2ab54be2baea28584040996fcea0e732ab4508af1785679bb4cca8b9eaa13f4fe7361b6f893a1348663f250ed5398224098f9aa496841261e67cf70647d6343b3c840106b711983d036a1b69b587cb9c418ec983bc073ee6c98eb86bb1e2fc2694f38d77f15ad6c43deebd98e18462d319e700000000000000000000000000000000000000000000000000000000000000d3313244334b6f6f57536635597765365479523151566e534a794c79526e56736b7a45445443543868555a426879676a34324d6e622c313244334b6f6f574479686b517866325536474a4e477775766e54705a36786476516d743265653257626a4d4b53316e336a58732c313244334b6f6f574539695766766259513970473862445a347854576752514e7971536d7470554a6e553842507a7277373950432c313244334b6f6f57536e52486d754271484a34446b5342544e7733574d424a4d426d665a614174696336383833776d716f686335000000000000000000000000002e71d8139a158450a2fc094f7456ac3169827dea3622f478a034b81bcd46a65d1a1bf753c2505dab5204b284f1fefd7dc4eb83f6304664c9c2f43cbf42566660000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000046982aaa5278cc392587c69417337e7fc000000000000000000000000000000000d710a1bf671882660709845ec1600c40000000000000000000000000000000054a2765c7a4dbf5d02958ba5b7f5cb7400000000000000000000000000000000afe5f12da71a105f6ed5beaee91c2a1100000000000000000000000000000000',
            {gasPrice:10000000000, gasLimit:2100000});
        console.log('setconfig_tx', setConfig_tx);
    })
    it('setconfig_test ', async () => {
        let provider = ethers.getDefaultProvider("https://twilight-magical-snowflake.ethereum-sepolia.discover.quiknode.pro/d88ffbe6a53853e28f56142c912a288eb298dada/");
        let privateKey = 'b588f6bf79507310840ba922e1a28c8cd16a5db34ac8161a8c5932692d0addfc';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0xF28e2d06D688Dc1DF0ACA3A2F37d09D3b9b3df56', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        console.log('addr:', contractWithSigner.address);
        const setPayees_tx = await contractWithSigner.setPayees(['0x9FA5556B8B260B09773EDe96086daC38Aa5A4BCb','0xD2c10a30732CF7eC3EB69A733F09BC67d4E46aB5','0x9f10466dFA8a5a34b199c15Af3BA26488E319328','0x5bE9Dd2BE5143f751779E60dAF8c64a27E31f43c'],
        ['0x9FA5556B8B260B09773EDe96086daC38Aa5A4BCb','0xD2c10a30732CF7eC3EB69A733F09BC67d4E46aB5','0x9f10466dFA8a5a34b199c15Af3BA26488E319328','0x5bE9Dd2BE5143f751779E60dAF8c64a27E31f43c']);
        console.log('setPayees_tx:', setPayees_tx);

        const setConfig_tx = await  contractWithSigner.setConfig(['0x37aF2e3356D9c86124A1EA2D58637A650aB3B762','0xe5209F6D1C2Fa537428e0d3EbF91BAFB7502dE45','0x7e1A1eFa0C663E930EF717c9Db9dd0B08a459052','0x62545E0AD661120d554CE56D77db6854561aE9B3'],
        ['0x9FA5556B8B260B09773EDe96086daC38Aa5A4BCb','0xD2c10a30732CF7eC3EB69A733F09BC67d4E46aB5','0x9f10466dFA8a5a34b199c15Af3BA26488E319328','0x5bE9Dd2BE5143f751779E60dAF8c64a27E31f43c'],
            1, 1,
            '0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000068c61714000000000000000000000000000000000000000000000000000000000037e11d600000000000000000000000000000000000000000000000000000001a3185c500000000000000000000000000000000000000000000000000000000000773594000000000000000000000000000000000000000000000000000000034630b8a000000000000000000000000000000000000000000000000000000000000098968000000000000000000000000000000000000000000000000000000006fc23ac0000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000043674d6e4abbaa1cb773f29d999563268fb3417b99b140b4cdafe9c9d54cbc31b00e7f28b5454feb2c1df7a87fd241b9e84e8c515c04b34409d6bf95e2198b1d05ecea5803bced092163aadb26603699e82aa33d409213c75a66851517d9f4f7ede9d6d8cf8fe9a6f66ee29e69f86c2ec16aca83700a902d1188a824c5ffa851700000000000000000000000000000000000000000000000000000000000000d3313244334b6f6f5753417353614c6e694858706e5644644e5a4e71394e694b654670743962456d5054456631325754345152334a2c313244334b6f6f57507447486977717933476b4c503954366a4e455a6e79766464446752364c6f44364b6e4c68785a314a48536f2c313244334b6f6f574b743650674146434e624c4c564834443139546e45694564486239456771516f59693965694662686e6463422c313244334b6f6f5751524637424446575a6f7346656e757354365557466464334e6b56645066784c67766b4745675652597777700000000000000000000000000080f07990c6a766929c6b2ced493237d36a30f2c3d34c25777b2fe06f7d3915221a1bf753c2505dab5204b284f1fefd7dc4eb83f6304664c9c2f43cbf42566660000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000045f1f86097bdf9cb4304553e39544b3ca00000000000000000000000000000000bf0dc68a3c635b24bee8525f9c7c6e0e00000000000000000000000000000000abf86f77bc1932a9ef0e67f84994cfe60000000000000000000000000000000049c9df3c70774657e0da24a2e49df08900000000000000000000000000000000',
            {gasPrice:1000000000, gasLimit:2100000});
        console.log('setconfig_test_tx', setConfig_tx);
        console.log('t:', await contractWithSigner.transmitters());
    })
    it('getanswer ', async () => {
        let provider = ethers.getDefaultProvider("https://twilight-magical-snowflake.ethereum-sepolia.discover.quiknode.pro/d88ffbe6a53853e28f56142c912a288eb298dada/");
        let privateKey = 'b588f6bf79507310840ba922e1a28c8cd16a5db34ac8161a8c5932692d0addfc';
        let wallet = new ethers.Wallet(privateKey, provider);
        const offchainAggregatorC = await AccessControlledOffchainAggregator__factory.connect('0x7fac6B3BFCfbDE3a77D79ae41F7C0838809515eF', provider);
        let contractWithSigner = await offchainAggregatorC.connect(wallet);
        const getAnswer_tx = await  contractWithSigner.latestMerkleRoundData("TDlrNBKvAbmEdNg718jp9g43R5");
        console.log('getAnswer_tx', getAnswer_tx);
    })
    it('getTransmitters ', async () => {
        const [ownerSigner] = await ethers.getSigners();
        const offchainAggregatorC =  AccessControlledOffchainAggregator__factory.connect('0x89abA3AEceE8b889bf1FaDD6565c2177e5c82Ee4', ownerSigner);
        console.log('addr:', offchainAggregatorC.address);
        console.log('t:', await offchainAggregatorC.transmitters());
    })
})
